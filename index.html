<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ob-havo Neon</title>
    <style>
        *{box-sizing:border-box;}
        body{
            margin:0;height:100vh;background:#000;color:#0f0;
            font-family:'Courier New',monospace;
            display:flex;flex-direction:column;justify-content:center;align-items:center;
            overflow:hidden;padding:10px;
        }
        .container{
            width:100%;max-width:900px;display:flex;flex-direction:column;
            align-items:center;justify-content:center;flex:1;
        }

        /* Status Panel */
        .panel {
            position: absolute;
            top: 12px;
            background: #111;
            border: 3px solid #0f0;
            border-radius: 15px;
            padding: 12px 20px;
            font-size: clamp(16px, 4vw, 24px);
            font-weight: bold;
            color: #0f0;
            box-shadow: 0 0 30px #0f0;
            line-height: 1.5;
            z-index: 10;
            transition: all 0.3s;
        }

        #status-panel {
            right: 12px;
            text-align: center;
        }

        /* Main Title */
        #mainTitle {
            font-size: clamp(40px, 10vw, 100px);
            letter-spacing:0.08em;
            margin:10px 0 40px 0;
            text-shadow:0 0 30px #0f0;
            font-weight:bold;
            text-transform: uppercase;
        }

        /* Temperature Circle */
        .temp-circle {
            /* Circle size logic */
            width: clamp(250px, 80vw, 450px);
            height: clamp(250px, 80vw, 450px);

            /* Container Query definition: allows children to size relative to this box */
            container-type: size;

            border-radius: 50%;
            background: #111;
            border: clamp(12px, 4vw, 20px) solid #0f0;
            box-shadow: 0 0 80px #0f0;

            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;

            transition: all 0.3s;
            color: #0f0;
            position: relative;
        }

        /* Wrapper to center the text group */
        .temp-content-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            /* Adjust position slightly if needed */
            padding-bottom: 5cqh;
        }

        .temp-value {
            /* 32cqw means 32% of the circle's width.
               This guarantees it fits whether the circle is 200px or 500px. */
            font-size: 32cqw;
            font-weight: bold;
            text-shadow: 0 0 5cqw #0f0; /* Shadow scales too */
            line-height: 1;
        }

        .temp-unit {
            font-size: 12cqw; /* Relative to circle size */
            margin-left: 1cqw;
            /* Move unit up to look like superscript */
            transform: translateY(-10cqw);
            opacity: 0.9;
        }

        /* Offline State Styles */
        body.offline .panel {
            border-color: #f00;
            color: #f00;
            box-shadow: 0 0 30px #f00;
        }
        body.offline #mainTitle {
            color: #f00;
            text-shadow: 0 0 30px #f00;
        }
        body.offline .temp-circle {
            border-color: #f00;
            box-shadow: 0 0 80px #f00;
            color: #f00;
        }
        body.offline .temp-value {
            text-shadow: 0 0 5cqw #f00;
        }

        /* Loader */
        .loader {
            border: 8px solid rgba(0, 255, 0, 0.1);
            border-top: 8px solid #0f0;
            border-radius: 50%;
            width: 20cqw; /* Loader scales with circle */
            height: 20cqw;
            animation: spin 1s linear infinite;
            position: absolute;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden { display: none !important; }

    </style>
</head>
<body>

    <!-- Status Panel Only -->
    <div id="status-panel" class="panel">
        <span id="status-text">ONLINE</span>
    </div>

    <div class="container">
        <div id="mainTitle">OB-HAVO</div>

        <div class="temp-circle" id="temp-circle">
            <div class="loader" id="loader"></div>

            <div id="temp-content" class="temp-content-wrapper hidden">
                <span id="temp-val" class="temp-value">--</span>
                <span class="temp-unit">Â°C</span>
            </div>
        </div>
    </div>

    <script>
        const tempVal = document.getElementById('temp-val');
        const tempContent = document.getElementById('temp-content');
        const loader = document.getElementById('loader');
        const statusText = document.getElementById('status-text');

        // Tashkent coordinates
        const LAT = 41.2995;
        const LON = 69.2401;
        const API_URL = `https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&current_weather=true`;

        function updateOnlineStatus() {
            if (navigator.onLine) {
                document.body.classList.remove('offline');
                statusText.innerText = "ONLINE";
                fetchWeather();
            } else {
                document.body.classList.add('offline');
                statusText.innerText = "OFFLINE";

                loader.style.display = 'none';
                tempContent.classList.remove('hidden');
                tempVal.innerText = "--";
            }
        }

        async function fetchWeather() {
            if (!navigator.onLine) return;

            loader.style.display = 'block';
            tempContent.classList.add('hidden');

            try {
                // TEST UCHUN: 50 va 55 orasidagi tasodifiy son
                await new Promise(r => setTimeout(r, 500));
                const temp = Math.floor(Math.random() * (55 - 50 + 1) + 50);

                // Raqamni chiqarish
                const tempStr = (temp > 0 ? "+" : "") + temp;
                tempVal.innerText = tempStr;

                tempContent.classList.remove('hidden');
            } catch (error) {
                console.error('Error fetching weather:', error);
            } finally {
                loader.style.display = 'none';
            }
        }

        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);

        // Initial check
        updateOnlineStatus();

        // Refresh every 10 minutes
        setInterval(fetchWeather, 600000);
    </script>

</body>
</html>
