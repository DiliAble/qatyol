<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ob-havo Neon</title>
    <style>
        *{box-sizing:border-box;}
        body{
            margin:0;height:100vh;background:#000;color:#0f0;
            font-family:'Courier New',monospace;
            display:flex;flex-direction:column;justify-content:center;align-items:center;
            overflow:hidden;padding:10px;
        }
        .container{
            width:100%;max-width:900px;display:flex;flex-direction:column;
            align-items:center;justify-content:center;flex:1;
        }

        /* Top Panels like Morse Trainer */
        .panel {
            position: absolute;
            top: 12px;
            background: #111;
            border: 3px solid #0f0;
            border-radius: 15px;
            padding: 12px 20px;
            font-size: clamp(16px, 4vw, 24px);
            font-weight: bold;
            color: #0f0;
            box-shadow: 0 0 30px #0f0;
            line-height: 1.5;
            z-index: 10;
            transition: all 0.3s;
        }

        #status-panel {
            right: 12px;
            text-align: center;
        }

        /* Main Title */
        #mainTitle {
            font-size: clamp(40px, 10vw, 100px);
            letter-spacing:0.08em;
            margin:10px 0 40px 0;
            text-shadow:0 0 30px #0f0;
            font-weight:bold;
            text-transform: uppercase;
        }

        /* Temperature Circle */
        .temp-circle {
            width:clamp(250px, 80vw, 450px);
            height:clamp(250px, 80vw, 450px);
            border-radius:50%;
            background:#111;
            border:clamp(12px, 4vw, 20px) solid #0f0;
            box-shadow:0 0 80px #0f0;
            display:flex;
            flex-direction: column;
            align-items:center;
            justify-content:center;
            transition:all 0.3s;
            color:#0f0;
            position: relative;
        }

        .temp-value {
            /* Default size (approx 2x smaller than before) */
            font-size: clamp(50px, 15vw, 110px);
            font-weight: bold;
            text-shadow: 0 0 20px #0f0;
            line-height: 1;
            margin-top: 10px;
            transition: font-size 0.3s;
        }

        /* Class for 2-digit numbers (approx 3x smaller than original) */
        .temp-value.small-text {
            font-size: clamp(33px, 10vw, 150px);
        }

        .temp-unit {
            font-size: clamp(20px, 5vw, 40px);
            position: absolute;
            top: 25%;
            right: 20%;
            opacity: 0.8;
        }

        /* Offline State Styles */
        body.offline .panel {
            border-color: #f00;
            color: #f00;
            box-shadow: 0 0 30px #f00;
        }
        body.offline #mainTitle {
            color: #f00;
            text-shadow: 0 0 30px #f00;
        }
        body.offline .temp-circle {
            border-color: #f00;
            box-shadow: 0 0 80px #f00;
            color: #f00;
        }
        body.offline .temp-value {
            text-shadow: 0 0 20px #f00;
        }

        /* Loader */
        .loader {
            border: 8px solid rgba(0, 255, 0, 0.1);
            border-top: 8px solid #0f0;
            border-radius: 50%;
            width: 80px;
            height: 80px;
            animation: spin 1s linear infinite;
            position: absolute;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden { display: none; }

    </style>
</head>
<body>

    <!-- Status Panel Only -->
    <div id="status-panel" class="panel">
        <span id="status-text">ONLINE</span>
    </div>

    <div class="container">
        <div id="mainTitle">OB-HAVO</div>

        <div class="temp-circle" id="temp-circle">
            <div class="loader" id="loader"></div>
            <div id="temp-content" class="hidden" style="position: relative; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;">
                <span id="temp-val" class="temp-value">--</span>
                <span class="temp-unit">Â°C</span>
            </div>
        </div>
    </div>

    <script>
        const tempVal = document.getElementById('temp-val');
        const tempContent = document.getElementById('temp-content');
        const loader = document.getElementById('loader');
        const statusText = document.getElementById('status-text');

        // Tashkent coordinates
        const LAT = 41.2995;
        const LON = 69.2401;
        const API_URL = `https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&current_weather=true`;

        function updateOnlineStatus() {
            if (navigator.onLine) {
                document.body.classList.remove('offline');
                statusText.innerText = "ONLINE";
                fetchWeather();
            } else {
                document.body.classList.add('offline');
                statusText.innerText = "OFFLINE";

                // Hide loader, show dashes
                loader.style.display = 'none';
                tempContent.classList.remove('hidden');
                tempVal.innerText = "--";
                tempVal.classList.remove('small-text');
            }
        }

        async function fetchWeather() {
            if (!navigator.onLine) return;

            loader.style.display = 'block';
            tempContent.classList.add('hidden');

            try {
                // TEST UCHUN: 50 va 55 orasidagi tasodifiy son
                await new Promise(r => setTimeout(r, 500));
                const temp = Math.floor(Math.random() * (55 - 50 + 1) + 50);

                // Raqam uzunligini tekshirish (masalan, 10 dan katta yoki kichik -9 bo'lsa 2 xonali hisoblanadi)
                // Yoki shunchaki string uzunligiga qarab
                const tempStr = "+" + temp;
                tempVal.innerText = tempStr;

                // Agar raqam 2 xonali bo'lsa (masalan 50), "+" bilan birga uzunligi 3 bo'ladi.
                // Agar 1 xonali bo'lsa (masalan 5), "+" bilan birga uzunligi 2 bo'ladi.
                // Foydalanuvchi "2 xonali son" deganda qiymatni nazarda tutgan bo'lsa:
                if (Math.abs(temp) >= 10) {
                    tempVal.classList.add('small-text');
                } else {
                    tempVal.classList.remove('small-text');
                }

                tempContent.classList.remove('hidden');
            } catch (error) {
                console.error('Error fetching weather:', error);
            } finally {
                loader.style.display = 'none';
            }
        }

        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);

        // Initial check
        updateOnlineStatus();

        // Refresh every 10 minutes
        setInterval(fetchWeather, 600000);
    </script>

</body>
</html>
